<!DOCTYPE html>
<html>
<head>
    <style>
        /* Styling the table */
        table {
            width: 100%;
            border-collapse: collapse;
            background-color: #e6ffe6; /* Light green background for the table */
        }

        th, td {
            border: 1px solid #99cc99; /* Green border for cells */
            padding: 10px;
            text-align: left;
        }

        th {
            background-color: #66cc66; /* Darker green for header */
            color: white; /* White text for header */
        }

        tr:nth-child(even) {
            background-color: #ccffcc; /* Alternating light green for even rows */
        }

        tr:hover {
            background-color: #b3ffb3; /* Highlight row on hover */
        }

        /* Styling the back button */
        .back-button {
            display: inline-block;
            margin: 20px 0;
            padding: 10px 20px;
            background-color: #66cc66; /* Green button background */
            color: white; /* White text */
            text-decoration: none; /* Remove underline */
            border-radius: 5px; /* Rounded corners */
            border: none; /* No border */
            cursor: pointer; /* Pointer cursor on hover */
        }

        .back-button:hover {
            background-color: #55aa55; /* Darker green on hover */
        }

        /* Styling the dropdowns */
        .filter-container {
            margin: 20px 0;
        }

        select {
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #99cc99;
            margin-right: 10px;
        }

        /* Styling the delete button */
        button {
            padding: 5px 10px;
            background-color: #ff6666; /* Red background for delete */
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        button:hover {
            background-color: #cc5555; /* Darker red on hover */
        }
    </style>
</head>
<body>
    {% if messages %}
    <div>
        {% for message in messages %}
            <p style="color: red; font-size: 18px; text-align: center;"><b>{{ message }}</b></p>
        {% endfor %}
    </div>
    {% endif %}
    <a href="{% url 'home' %}" class="back-button">Back</a>

    <!-- Filter dropdowns -->
    <div class="filter-container">
        <label for="monthFilter">Month:</label>
        <select id="monthFilter" onchange="filterTable()">
            <option value="">All Months</option>
            <option value="1">January</option>
            <option value="2">February</option>
            <option value="3">March</option>
            <option value="4">April</option>
            <option value="5">May</option>
            <option value="6">June</option>
            <option value="7">July</option>
            <option value="8">August</option>
            <option value="9">September</option>
            <option value="10">October</option>
            <option value="11">November</option>
            <option value="12">December</option>
        </select>

        <label for="yearFilter">Year:</label>
        <select id="yearFilter" onchange="filterTable()">
            <option value="">All Years</option>
            <!-- Years will be populated dynamically via JS -->
        </select>
    </div>

    <table id="expenseTable">
        <thead>
            <tr>
                <th>Expense Category</th>
                <th>Amount</th>
                <th>Date</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for i in e %}
            <tr>
                <td>{{ i.expensecategory }}</td>
                <td>{{ i.amount }}</td>
                <td>{{ i.date }}</td>
                <td>
                    <a href="/editexpense/{{ i.id }}">Edit</a>
                    <form action="{% url 'delete_expense' i.id %}" method="POST" style="display:inline;">
                        {% csrf_token %}
                        <button type="submit" onclick="return confirm('Are you sure you want to delete this expense?');">
                            Delete
                        </button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <script>
        // Populate the year dropdown dynamically
        function populateYears() {
            const yearSelect = document.getElementById('yearFilter');
            const currentYear = new Date().getFullYear();
            const startYear = 2000; // Adjust as needed

            for (let year = currentYear; year >= startYear; year--) {
                const option = document.createElement('option');
                option.value = year;
                option.text = year;
                yearSelect.appendChild(option);
            }
        }

        // Filter table rows based on selected month and year
        function filterTable() {
            const monthFilter = document.getElementById('monthFilter').value;
            const yearFilter = document.getElementById('yearFilter').value;
            const table = document.getElementById('expenseTable');
            const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');

            for (let i = 0; i < rows.length; i++) {
                const row = rows[i];
                const dateCell = row.cells[2].textContent; // Date column (index 2)
                const date = new Date(dateCell); // Assuming date is in ISO format (e.g., 2025-03-15)

                const rowMonth = date.getMonth() + 1; // getMonth() returns 0-11, so +1 to match 1-12
                const rowYear = date.getFullYear();

                // Show/hide rows based on filters
                let showRow = true;
                if (monthFilter && monthFilter !== rowMonth.toString()) {
                    showRow = false;
                }
                if (yearFilter && yearFilter !== rowYear.toString()) {
                    showRow = false;
                }

                row.style.display = showRow ? '' : 'none';
            }
        }

        // Initialize the year dropdown and filter on page load
        window.onload = function() {
            populateYears();
            filterTable(); // Optional: Filters table if default values are set
        };
    </script>
</body>
</html>